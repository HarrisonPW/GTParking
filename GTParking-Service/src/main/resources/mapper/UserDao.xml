<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.GTParking.dao.UserDao">

    <resultMap type="org.GTParking.entity.po.User" id="UserMap">
        <result property="userid" column="userID" jdbcType="INTEGER"/>
        <result property="username" column="username" jdbcType="VARCHAR"/>
        <result property="permits" column="permits" jdbcType="ARRAY"/>
        <result property="isCheckedIn" column="isCheckedIn" jdbcType="BOOLEAN"/>
        <result property="isDriving" column="isDriving" jdbcType="BOOLEAN"/>
    </resultMap>

    <select id="queryById" resultMap="UserMap">
        select
        parkinglotID,name,location,totalSpotsNum,currentSpotsNum
        from ParkingLots
        where parkinglotID = #{parkinglotid}
    </select>

    <select id="queryAllByLimit" resultMap="UserMap">
        select
        parkinglotID,name,location,totalSpotsNum,currentSpotsNum
        from ParkingLots
        <where>
            <if test="po.parkinglotid != null">
                and parkinglotID = #{po.parkinglotid}
            </if>
            <if test="po.name != null and po.name != ''">
                and name = #{po.name}
            </if>
            <if test="po.location != null and po.location != ''">
                and location = #{po.location}
            </if>
            <if test="po.totalspotsnum != null">
                and totalSpotsNum = #{po.totalspotsnum}
            </if>
            <if test="po.currentspotsnum != null">
                and currentSpotsNum = #{po.currentspotsnum}
            </if>
        </where>
        ORDER BY parkinglotID
        OFFSET #{pageNo} ROWS
        FETCH NEXT #{pageSize} ROWS ONLY
    </select>

    <select id="count" resultType="java.lang.Long">
        select count(1)
        from ParkingLots
        <where>
            <if test="parkinglotid != null">
                and parkinglotID = #{parkinglotid}
            </if>
            <if test="name != null and name != ''">
                and name = #{name}
            </if>
            <if test="location != null and location != ''">
                and location = #{location}
            </if>
            <if test="totalspotsnum != null">
                and totalSpotsNum = #{totalspotsnum}
            </if>
            <if test="currentspotsnum != null">
                and currentSpotsNum = #{currentspotsnum}
            </if>
        </where>
    </select>

    <insert id="insert" keyProperty="parkinglotid" useGeneratedKeys="true">
        insert into ParkingLots(name,location,totalSpotsNum,currentSpotsNum)
        values (#{name},#{location},#{totalspotsnum},#{currentspotsnum})
    </insert>

    <insert id="insertBatch" keyProperty="parkinglotid" useGeneratedKeys="true">
        insert into ParkingLots(name,location,totalSpotsNum,currentSpotsNum)
        values
        <foreach collection="entities" item="entity" separator=",">
            (#{entity.name},#{entity.location},#{entity.totalspotsnum},#{entity.currentspotsnum})
        </foreach>
    </insert>

    <insert id="insertOrUpdateBatch" keyProperty="parkinglotid" useGeneratedKeys="true">
        insert into ParkingLots(name,location,totalSpotsNum,currentSpotsNum)
        values
        <foreach collection="entities" item="entity" separator=",">
            (#{entity.name},#{entity.location},#{entity.totalspotsnum},#{entity.currentspotsnum})
        </foreach>
        on duplicate key update
        name = values(name)location = values(location)totalSpotsNum = values(totalSpotsNum)currentSpotsNum = values(currentSpotsNum)
    </insert>

    <update id="update">
        update ParkingLots
        <set>
            <if test="name != null and name != ''">
                name = #{name},
            </if>
            <if test="location != null and location != ''">
                location = #{location},
            </if>
            <if test="totalspotsnum != null">
                totalSpotsNum = #{totalspotsnum},
            </if>
            <if test="currentspotsnum != null">
                currentSpotsNum = #{currentspotsnum},
            </if>
        </set>
        where parkinglotID = #{parkinglotid}
    </update>

    <delete id="deleteById">
        delete from ParkingLots where parkinglotID = #{parkinglotid}
    </delete>

</mapper>

